# Story 02.1: Establish Design Tokens and Theming

**Epic:** Epic 02 - Core Platform Services  
**Story ID:** 02.1  
**Priority:** P0 - Critical (Foundation)  
**Estimated Effort:** 5 story points  
**Status:** Approved  
**Created:** 2025-10-30  
**Updated:** 2025-10-30

---

## User Story

**As a** product designer,  
**I want** baseline typography, color, and spacing tokens available in Flutter,  
**So that** the app presents a cohesive visual language before feature work begins.

---

## Business Value

Establishing a design system foundation enables:
- Consistent UI/UX across all features
- Faster feature development with reusable tokens
- Easy theming updates (light/dark mode)
- Reduced technical debt from hard-coded values
- Design-development workflow alignment

**Success Metrics:**
- 100% of new widgets use design tokens (no hard-coded colors/spacing)
- Light/dark theme switching with <100ms latency
- Design token documentation completeness score ≥90%

---

## Acceptance Criteria

### AC1: Define Light/Dark Palettes
**Given** the app needs to support light and dark themes  
**When** a designer defines the color palette  
**Then** both light and dark color schemes are exported via a central Theme extension with semantic naming (primary, secondary, surface, error, etc.)

**Validation:**
- [ ] Light theme colors defined with hex values documented
- [ ] Dark theme colors defined with hex values documented
- [ ] Semantic color naming follows Material Design 3 guidelines
- [ ] Theme extension provides type-safe access to all colors

### AC2: Typography Scales and Spacing Constants
**Given** the app needs consistent typography and spacing  
**When** a designer defines type scales and spacing  
**Then** typography scales (display, headline, body, label) and spacing constants (xs, sm, md, lg, xl) are defined and accessible

**Validation:**
- [ ] 5 typography scales defined with font family, size, weight, line height
- [ ] 5 spacing constants defined (4dp, 8dp, 16dp, 24dp, 32dp)
- [ ] Tokens exported via centralized constants file
- [ ] Unit tests verify token accessibility

### AC3: Document Token Usage
**Given** developers need guidance on using design tokens  
**When** documentation is created  
**Then** token usage is documented in `docs/architecture/coding-standards.md` with widget examples

**Validation:**
- [ ] Coding standards updated with design token section
- [ ] Examples show correct and incorrect usage patterns
- [ ] Token naming conventions documented
- [ ] Migration guide for existing hard-coded values included

### AC4: Sample Screens Consume Tokens
**Given** the design system needs validation  
**When** sample screens are created  
**Then** splash screen and placeholder feed demonstrate token usage without hard-coded colors/spacing

**Validation:**
- [ ] Splash screen uses theme colors and spacing
- [ ] Placeholder feed uses typography scales
- [ ] No magic numbers in sample screen code
- [ ] Dark mode switching works correctly on samples

---

## Technical Implementation

### Files to Create/Modify
```
video_window_flutter/
├── packages/shared/
│   └── lib/
│       ├── theme/
│       │   ├── app_theme.dart           # Main theme configuration
│       │   ├── color_palette.dart       # Light/dark color definitions
│       │   ├── typography.dart          # Type scales
│       │   └── spacing.dart             # Spacing constants
│       └── widgets/
│           ├── splash_screen.dart       # Example: splash
│           └── placeholder_feed.dart    # Example: feed
└── docs/architecture/
    └── coding-standards.md              # Updated with token guidance
```

### Design Token Structure
```dart
// color_palette.dart
class AppColorPalette {
  final Color primary;
  final Color secondary;
  final Color surface;
  final Color error;
  // ... semantic colors
  
  const AppColorPalette.light({...});
  const AppColorPalette.dark({...});
}

// typography.dart
class AppTypography {
  static const displayLarge = TextStyle(...);
  static const headlineMedium = TextStyle(...);
  static const bodyLarge = TextStyle(...);
  // ... type scales
}

// spacing.dart
class AppSpacing {
  static const xs = 4.0;
  static const sm = 8.0;
  static const md = 16.0;
  static const lg = 24.0;
  static const xl = 32.0;
}
```

---

## Dependencies

### Prerequisites
- Epic 01.1 complete (repository structure exists)
- Flutter 3.19.6 environment configured
- Melos workspace bootstrapped

### Blocks
- All UI feature stories (4.1, 5.1, etc.) depend on this

---

## Testing Requirements

### Unit Tests
- [ ] Theme extension provides correct colors for light/dark modes
- [ ] Typography constants accessible and correctly defined
- [ ] Spacing constants have expected values
- [ ] Theme switching updates all token references

### Widget Tests
- [ ] Splash screen renders correctly in light mode
- [ ] Splash screen renders correctly in dark mode
- [ ] Theme changes propagate to all widgets
- [ ] Golden tests for sample screens

### Integration Tests
- [ ] Theme mode persists across app restarts
- [ ] System theme changes trigger app theme updates

**Test Coverage Target:** ≥85%

---

## Definition of Done Checklist

- [ ] All acceptance criteria validated
- [ ] Code review completed and approved
- [ ] Unit tests written and passing (≥85% coverage)
- [ ] Widget tests for sample screens passing
- [ ] Documentation updated in coding-standards.md
- [ ] No hard-coded colors/spacing in sample screens
- [ ] Light/dark mode switching works correctly
- [ ] CI/CD pipeline passing (format, analyze, test)
- [ ] Design team approval obtained
- [ ] Story demo completed

---

## Notes

**Design Notes:**
- Color palette should support WCAG 2.1 AA contrast requirements (4.5:1 minimum)
- Consider colorblind-friendly palette choices
- Dark mode should be true dark (not just inverted colors)

**Technical Notes:**
- Use ThemeExtension for custom properties beyond Material defaults
- Consider platform-specific theming (iOS vs Android) if needed
- Token file should be code-generated if design tools support export

**Security Notes:**
- No sensitive data in theme configuration
- Theme preferences stored locally (non-sensitive)

---

## Related Documents

- [Epic 02 Tech Spec](../tech-spec-epic-2.md) (TODO: Create)
- [Coding Standards](../architecture/coding-standards.md)
- [Package Architecture Requirements](../architecture/package-architecture-requirements.md)
- [PRD - Epic 02](../prd.md#epic-02-core-platform-services)

---

**Story Status:** Approved ✅  
**Approval Date:** 2025-10-30  
**Approved By:** John (PM), Winston (Architect), Sally (UX), Amelia (Dev Lead)
