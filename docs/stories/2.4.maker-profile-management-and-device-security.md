# Story 2.4: Maker Profile Management & Device Security

## Status
Ready for Dev

## Story
**As a** maker operations lead,
**I want** makers to manage their profile and trusted devices securely,
**so that** accounts stay protected while makers control their business presence.

## Acceptance Criteria
1. Makers can update business profile details (display name, tax info, payout preferences) with validation, audit trail, and encrypted storage for sensitive fields. [Source: docs/tech-spec-epic-2.md#maker-profile-entity]
2. Device management UI lists registered devices with trust score, last seen, and provides revoke + mark as primary actions; revocation invalidates sessions and refresh tokens on that device. [Source: docs/tech-spec-epic-2.md#source-tree--file-directives]
3. **SECURITY CRITICAL**: New device registration requires attestation metadata (platform, OS version, jailbreak/root status). Risk scores below configured threshold block maker access until reviewed. [Source: docs/tech-spec-epic-2.md#implementation-guide]
4. Admins receive alerts when high-risk device events occur (trust_score < 30 or multiple revocations in 24h) and can view device audit log. [Source: docs/tech-spec-epic-2.md#security-monitoring]
5. Device revocation and profile changes stream to analytics + audit topics with correlation IDs. [Source: docs/tech-spec-epic-2.md#monitoring-and-analytics]

## Prerequisites
1. Story 2.1 – Maker Onboarding & Invitation Flow (provides onboarding checklist)
2. Story 2.3 – Maker Identity Verification & KYC Processes (ensures verified makers before device trust enforcement)
3. Session refresh hardening from Story 1.3 available for token rotation.

## Tasks / Subtasks

### Profile Management
- [ ] Implement `maker_profile_page.dart` for profile editing with field-level validation and encrypted writes. [Source: docs/tech-spec-epic-2.md#source-tree--file-directives]
- [ ] Extend `maker_profile` repository/service to update encrypted fields via KMS; log changes to audit stream. [Source: docs/tech-spec-epic-2.md#database-migrations]
- [ ] Add toast + email notification summarizing profile updates and providing rollback link.

### Device Registry & Trust Scoring
- [ ] Build `maker_device_security_page.dart` listing devices, trust score, and actions (AC: 2). [Source: docs/tech-spec-epic-2.md#source-tree--file-directives]
- [ ] Implement `device_security_service.dart` (client + server) handling device registration, attestation validation, trust scoring, and revocation. [Source: docs/tech-spec-epic-2.md#implementation-guide]
- [ ] Integrate with SessionService to revoke tokens when device removed or risk score drops below threshold (AC: 2,3).

### Alerts & Observability
- [ ] Stream device events to `audit.device_security` and analytics for dashboarding (AC: 4,5). [Source: docs/tech-spec-epic-2.md#monitoring-and-analytics]
- [ ] Configure alerting rule: trust score <30 or >3 revocations/day triggers PagerDuty incident for security team.

## Data Models
- `maker_profiles` and `maker_devices` tables store profile/device data with timestamps, trust score, and revocation metadata. [Source: docs/tech-spec-epic-2.md#database-migrations]

## API Specifications
- `GET /maker/profile`, `PUT /maker/profile`, `GET /maker/devices`, `POST /maker/devices`, `DELETE /maker/devices/{id}` defined in spec. [Source: docs/tech-spec-epic-2.md#maker-verification-endpoints]

## Component Specifications
- Flutter components reside under `video_window_flutter/packages/features/auth/lib/presentation/pages/` with supporting BLoC/use cases for profile + device flows. [Source: docs/tech-spec-epic-2.md#source-tree--file-directives]
- Server services perform AES-256 encryption and trust scoring logic. [Source: docs/tech-spec-epic-2.md#implementation-guide]

## Testing Requirements
- Unit tests: profile validation, device trust scoring, revocation logic, notifications. [Source: docs/tech-spec-epic-2.md#testing-strategy]
- Integration tests: new device registration + attestation, revocation invalidating sessions, high-risk alert path.
- Performance tests: ensure device list fetch scales to 20 devices without >150ms latency increase.

## Technical Constraints
- Device trust scoring integrates with risk heuristics defined by security team; maintain configuration via YAML in `security/device-risk-profile.yaml`.
- Encrypted fields must use same KMS CMK as KYC documents for operational simplicity. [Source: docs/tech-spec-epic-2.md#technology-stack]

## Change Log
| Date       | Version | Description | Author |
| ---------- | ------- | ----------- | ------ |
| 2025-10-29 | v1.0    | Initial profile + device security story authored | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
_(To be completed by Dev Agent)_

### Debug Log References
_(To be completed by Dev Agent)_

### Completion Notes List
_(To be completed by Dev Agent)_

### File List
_(To be completed by Dev Agent)_

## QA Results
_(To be completed by QA Agent)_
