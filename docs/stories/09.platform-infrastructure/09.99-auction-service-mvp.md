# 09.99 — Auction Service MVP

Status: Draft → InProgress → Ready for Review → Done

## Summary
Build a minimal Auction Service to support creating/opening an auction on first bid, placing/listing bids, and basic state transitions and timers with realtime updates.

## Acceptance Criteria
- API: POST /auctions (on first bid) returns auction; POST /auctions/{id}/bids accepts validated bids; GET /auctions/{id} returns auction + bids.
- First valid bid for an item creates an auction in state=open; subsequent bids validate min increment and bidder eligibility.
- Auction transitions to ended when timer completes; anti-snipe optional in pilot (extend N seconds on last-minute bid).
- Realtime updates broadcast BidPlaced and AuctionOpened/Ended via WS; polling fallback acceptable ≤10s.
- Basic rate limiting and input validation; errors return structured codes.
- Observability: logs and metrics for requests, errors, and state transitions.

## Telemetry
- auction_opened, bid_submitted, bid_confirmed, auction_state_changed, error_api.

## Notes
- Feature flag to enable auction endpoints.
- Region gating for pilot.

## Interfaces (MVP)
- POST /auctions {itemId, firstBid:{bidderId, amount}} → {auction}
- POST /auctions/{id}/bids {bidderId, amount} → {bid}
- GET /auctions/{id} → {auction, bids:[...]}

## Data Model (MVP)
- Auction {id, itemId, state:open|ended, startAt, endAt, minIncrement, antiSnipe?}
- Bid {id, auctionId, bidderId, amount, createdAt}

## Definition of Done
- REST APIs implemented (POST /auctions, POST /auctions/{id}/bids, GET /auctions/{id}) with validation and structured errors.
- Min bid increment rule (+1 USD) enforced; currency precision and rounding handled.
- Auction timers implemented with deterministic end; optional anti-snipe togglable.
- WebSocket channels broadcast BidPlaced, AuctionOpened/Ended; polling fallback documented.
- Region gating (UA-only) checked server-side; feature flags honored.
- Observability: logs, metrics for latency/error rates; basic rate limiting.
- Security: input sanitization; auth/permissions for creators/bidders.
- Load/perf smoke test for small pilot cohort.

## Dev tasks
- Define data models and persistence; create indexes for auction lookups.
- Implement endpoints with validation (min increment, bidder eligibility).
- Implement timers and WS broadcaster; polling GET path optimized.
- Add middleware for region/flags checks.
- Add metrics/structured logs; error taxonomy.

## QA checklist
- First bid creates auction; subsequent bids validated and persisted.
- Min increment +1 USD enforced; edge cases (equal, below, non-numeric) handled.
- Auction lifecycle: open → ended on timer; WS events emitted; polling returns correct state.
- UA-only gating; feature flags toggles behave as expected.
- Error responses structured and documented; rate limiting works.
