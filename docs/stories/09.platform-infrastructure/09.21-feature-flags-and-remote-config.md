# 09.21 — Feature Flags and Remote Config (Auctions)

## Status
InProgress

## Priority
P0 (Pilot)

> Workflow: Draft → InProgress → Ready for Review → Done

## Summary
Introduce feature flags and remote configuration to control the auctions pilot: enable/disable bid-from-feed, show auction indicators, enforce Ukraine-only pilot region, allowlist pilot cohorts, and provide a global kill switch.

## Acceptance Criteria
- Server and client support a feature flag namespace `auctions.*` including:
  - `auctions.enabled` (global kill switch)
  - `auctions.bid_from_feed.enabled`
  - `auctions.region_allowlist` (e.g., ["UA"]) and `auctions.creator_allowlist`
  - `auctions.ui.show_badges` (feed/overlay indicators)
- Region gating: Ukraine-only pilot enforced in client surfaces and server endpoints.
- Allowlist gating: limit to pilot creators and (optionally) pilot users.
- Remote-config values fetched on app start and refreshed with sensible TTL; offline cache with last-known-good.
- Telemetry: exposure and decision events logged (e.g., `ff_exposed`, `ff_decision`) including flag key and variant.
- Kill switch: turning off `auctions.enabled` hides CTA/indicators and blocks related API calls within ≤5 minutes.

## Telemetry
- ff_exposed {key, variant}
- ff_decision {key, variant, reason}
- feature_kill_switch_triggered {namespace}

## Notes
- Server middleware validates flags/region on auction endpoints.
- Respect privacy: no PII in flag payloads; use anonymous identifiers.

## Files/Areas Impacted
- Remote-config service
- Client gating at feed overlay, bid CTA, item details
- Server middleware for auction APIs

## Definition of Done
- Flag keys defined and documented; defaults safe (disabled).
- Clients fetch and cache flags; stale-while-revalidate implemented with TTL.
- UA-only region allowlist enforced; creator allowlist respected.
- Kill switch verified to hide surfaces and block APIs ≤5 minutes.
- Telemetry for exposure/decisions integrated and visible in dashboards.
- Secrets not embedded; config via secure channels; code passes static analysis/tests.

## Tasks / Subtasks
- Implement remote-config client and server-side checks for auction endpoints.
- Wire flag checks to feed overlay, bid CTA, item details sections.
- Implement allowlist/region gating and kill switch propagation.
- Emit ff_exposed and ff_decision events with context.

## QA checklist
- Toggle tests: enable/disable flags change UI/API behavior as expected.
- UA-only: non-UA users do not see CTA/indicators; UA users do, when enabled.
- Kill switch: end-to-end within ≤5 minutes hides and blocks.
- Telemetry events emitted with correct keys/variants.

## Dev Agent Record
- Engineer: TBD
- Dates: TBD
- Notes: Use immutable snapshot per session to avoid mid-flow behavior drift; include versioning in config payloads.

## QA Results
- Owner: TBD
- Test window: TBD
- Summary: Pending; verify gating/kill switch interactions across flows.
