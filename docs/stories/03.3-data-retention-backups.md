# Story 03.3: Data Retention & Backup Procedures

**Epic:** 03 - Observability & Compliance Baseline  
**Story ID:** 03.3  
**Created:** 2025-10-30  
**Status:** Ready for Development

---

## User Story

**As an** operations lead,  
**I want** retention, backup, and recovery processes in place,  
**so that** data loss risks are mitigated and compliance targets are met.

---

## Business Value

Protects against data loss and ensures business continuity. Required for compliance (GDPR, CCPA) and operational resilience.

**Priority:** P1 (High - Operational Requirement)

---

## Acceptance Criteria

1. **Database Backup Schedule:**
   - Configure daily full backups (midnight UTC)
   - Enable point-in-time recovery (PITR) with ≤15 minute RPO
   - Verify backup restoration process (monthly drill)
   - Document backup restoration procedure in runbook

2. **Object Storage Lifecycle:**
   - Enforce log retention ≤30 days (S3 lifecycle policy)
   - Enforce analytics data retention ≤13 months
   - Retain transactional data ≥24 months (legal requirement)
   - Configure automated deletion rules

3. **Disaster Recovery Plan:**
   - Document PITR recovery steps (RTO ≤4 hours)
   - Schedule quarterly restore testing
   - Define escalation contacts for data recovery
   - Test backup restoration from last 7 days

4. **Monitoring & Alerts:**
   - Alert on backup failures (PagerDuty/email)
   - Monitor backup size trends (alert on >50% increase)
   - Track backup duration (alert if >2 hours)
   - Dashboard showing backup status and coverage

---

## Tasks / Subtasks

- [ ] **Task 1**: Database Backup Configuration (AC: 1)
  - [ ] Enable automated daily backups in RDS/managed database
  - [ ] Configure PITR with 15-minute granularity
  - [ ] Set backup retention period (30 days)
  - [ ] Document restoration procedure in `docs/runbooks/database-recovery.md`
  - [ ] Schedule monthly restore drill

- [ ] **Task 2**: S3 Lifecycle Policies (AC: 2)
  - [ ] Create lifecycle policy for logs bucket (delete after 30 days)
  - [ ] Create lifecycle policy for analytics bucket (delete after 13 months)
  - [ ] Configure transactional data retention (24+ months)
  - [ ] Configure media storage lifecycle (transition to Glacier after 90 days)
  - [ ] Document retention policies in `docs/compliance/data-retention.md`

- [ ] **Task 3**: Disaster Recovery Runbook (AC: 3)
  - [ ] Document PITR recovery steps with screenshots
  - [ ] Document full backup restoration steps
  - [ ] Define RTO (4 hours) and RPO (15 minutes) targets
  - [ ] List escalation contacts (on-call SRE, CTO)
  - [ ] Create incident response checklist

- [ ] **Task 4**: Backup Monitoring (AC: 4)
  - [ ] Create CloudWatch alarms for backup failures
  - [ ] Alert on backup duration >2 hours
  - [ ] Alert on backup size anomalies (>50% week-over-week increase)
  - [ ] Create Grafana dashboard for backup metrics
  - [ ] Configure PagerDuty integration for critical alerts

- [ ] **Task 5**: Restore Testing (AC: 1, 3)
  - [ ] Perform initial full restore test
  - [ ] Verify PITR recovery from 1 hour ago
  - [ ] Schedule quarterly restore drills (calendar)
  - [ ] Document test results and lessons learned

---

## Dependencies

- **Technical:** Production database deployed, S3 buckets created
- **Business:** Define data retention requirements with legal/compliance
- **Prerequisites:** Epic 01.1 complete, production infrastructure live

---

## Out of Scope

- Multi-region replication (single-region for MVP)
- Real-time replication to standby database
- Automated failover (manual failover for MVP)
- Encrypted backups (use provider-managed encryption)

---

## Related Files

- `deploy/terraform/rds-backup-config.tf`
- `deploy/terraform/s3-lifecycle-policies.tf`
- `docs/runbooks/database-recovery.md`
- `docs/runbooks/disaster-recovery.md`
- `docs/compliance/data-retention.md`

---

## Testing Requirements

### Integration Tests
- Backup creation verification
- Restore procedure validation

### Operational Tests
- Monthly restore drill execution
- Quarterly full disaster recovery exercise

**Minimum Coverage:** N/A (operational procedures)

---

## Notes

**Technical Notes:** Use AWS RDS automated backups or equivalent for managed databases. S3 lifecycle policies are free to configure.

**Compliance Notes:** GDPR Article 17 (Right to Erasure) requires ability to delete user data. Ensure backups don't prevent deletion compliance.

**Operational Notes:** Backup restoration should be tested regularly. Untested backups are not backups.

---

## Change Log

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2025-10-30 | 1.0 | Initial story creation | Bob (Scrum Master) |
